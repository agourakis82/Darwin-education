[
  {
    "table": "users",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 22,
    "line_end": 36,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "keycloak_id",
        "type": "VARCHAR(255) UNIQUE NOT NULL"
      },
      {
        "name": "username",
        "type": "VARCHAR(100) UNIQUE NOT NULL"
      },
      {
        "name": "email",
        "type": "VARCHAR(255)"
      },
      {
        "name": "locale",
        "type": "VARCHAR(10) DEFAULT 'pt'"
      },
      {
        "name": "country_code",
        "type": "VARCHAR(3)"
      },
      {
        "name": "is_mentor",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "specialization",
        "type": "VARCHAR(100)"
      },
      {
        "name": "bio",
        "type": "TEXT"
      },
      {
        "name": "avatar_url",
        "type": "VARCHAR(500)"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_progress",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 45,
    "line_end": 58,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "learning_path_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "module_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "status",
        "type": "VARCHAR(20) DEFAULT 'not_started' CHECK (status IN ('not_started', 'in_progress', 'completed'))"
      },
      {
        "name": "score",
        "type": "DECIMAL(5,2)"
      },
      {
        "name": "time_spent_seconds",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "synced_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      }
    ]
  },
  {
    "table": "certificates",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 67,
    "line_end": 75,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "learning_path_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "certificate_number",
        "type": "VARCHAR(50) UNIQUE NOT NULL"
      },
      {
        "name": "issued_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "verification_hash",
        "type": "VARCHAR(64) NOT NULL"
      }
    ]
  },
  {
    "table": "favorites",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 81,
    "line_end": 89,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "item_type",
        "type": "VARCHAR(50) NOT NULL CHECK (item_type IN ('disease', 'medication', 'protocol', 'screening', 'calculator'))"
      },
      {
        "name": "item_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "synced_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      }
    ]
  },
  {
    "table": "notes",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 97,
    "line_end": 107,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "item_type",
        "type": "VARCHAR(50) NOT NULL"
      },
      {
        "name": "item_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "synced_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      }
    ]
  },
  {
    "table": "forum_categories",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 115,
    "line_end": 120,
    "columns": [
      {
        "name": "id",
        "type": "VARCHAR(50) PRIMARY KEY"
      },
      {
        "name": "name_key",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "description_key",
        "type": "VARCHAR(200)"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      }
    ]
  },
  {
    "table": "forum_posts",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 130,
    "line_end": 144,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "author_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "category_id",
        "type": "VARCHAR(50) NOT NULL REFERENCES forum_categories(id)"
      },
      {
        "name": "locale",
        "type": "VARCHAR(10) DEFAULT 'pt'"
      },
      {
        "name": "title",
        "type": "VARCHAR(300) NOT NULL"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "is_case",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "is_pinned",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "is_locked",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "view_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "reply_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "forum_replies",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 151,
    "line_end": 159,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "post_id",
        "type": "UUID NOT NULL REFERENCES forum_posts(id) ON DELETE CASCADE"
      },
      {
        "name": "author_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "is_solution",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "clinical_cases",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 167,
    "line_end": 183,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "author_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "locale",
        "type": "VARCHAR(10) DEFAULT 'pt'"
      },
      {
        "name": "title",
        "type": "VARCHAR(300) NOT NULL"
      },
      {
        "name": "presentation",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "age_range",
        "type": "VARCHAR(20)"
      },
      {
        "name": "gender",
        "type": "VARCHAR(20)"
      },
      {
        "name": "diagnosis_codes",
        "type": "TEXT[], -- Array of ICD/ICPC codes"
      },
      {
        "name": "status",
        "type": "VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'pending_review', 'published', 'rejected'))"
      },
      {
        "name": "review_notes",
        "type": "TEXT"
      },
      {
        "name": "reviewed_by",
        "type": "UUID REFERENCES users(id)"
      },
      {
        "name": "reviewed_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      },
      {
        "name": "view_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "mentorship",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 192,
    "line_end": 202,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "mentor_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "mentee_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "specialization",
        "type": "VARCHAR(100)"
      },
      {
        "name": "status",
        "type": "VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'active', 'completed', 'declined'))"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      },
      {
        "name": "ended_at",
        "type": "TIMESTAMP WITH TIME ZONE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "mentorship_messages",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 207,
    "line_end": 214,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "mentorship_id",
        "type": "UUID NOT NULL REFERENCES mentorship(id) ON DELETE CASCADE"
      },
      {
        "name": "sender_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "is_read",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "sync_log",
    "file": "darwin-MFC/infrastructure/postgres/init.sql",
    "line_start": 222,
    "line_end": 231,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE"
      },
      {
        "name": "store",
        "type": "VARCHAR(50) NOT NULL"
      },
      {
        "name": "operation",
        "type": "VARCHAR(20) NOT NULL CHECK (operation IN ('create', 'update', 'delete'))"
      },
      {
        "name": "record_id",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "payload",
        "type": "JSONB"
      },
      {
        "name": "client_timestamp",
        "type": "TIMESTAMP WITH TIME ZONE"
      },
      {
        "name": "server_timestamp",
        "type": "TIMESTAMP WITH TIME ZONE DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.users",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 21,
    "line_end": 33,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "email",
        "type": "TEXT UNIQUE NOT NULL"
      },
      {
        "name": "name",
        "type": "TEXT"
      },
      {
        "name": "specialty",
        "type": "TEXT"
      },
      {
        "name": "country",
        "type": "TEXT"
      },
      {
        "name": "institution",
        "type": "TEXT"
      },
      {
        "name": "role",
        "type": "TEXT DEFAULT 'user' CHECK (role IN ('user', 'verified', 'moderator', 'admin'))"
      },
      {
        "name": "avatar_url",
        "type": "TEXT"
      },
      {
        "name": "bio",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.user_preferences",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 36,
    "line_end": 44,
    "columns": [
      {
        "name": "user_id",
        "type": "UUID PRIMARY KEY REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "theme",
        "type": "TEXT DEFAULT 'dark' CHECK (theme IN ('light', 'dark'))"
      },
      {
        "name": "language",
        "type": "TEXT DEFAULT 'pt' CHECK (language IN ('pt', 'en', 'es', 'fr', 'ru', 'ar', 'zh', 'el', 'hi'))"
      },
      {
        "name": "content_mode",
        "type": "TEXT DEFAULT 'descriptive' CHECK (content_mode IN ('descriptive', 'critical_analysis'))"
      },
      {
        "name": "notifications_enabled",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "email_notifications",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.user_progress",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 51,
    "line_end": 65,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "entity_type",
        "type": "TEXT NOT NULL CHECK (entity_type IN ('disease', 'medication', 'protocol', 'case', 'calculator', 'learning_path', 'module'))"
      },
      {
        "name": "entity_id",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "progress",
        "type": "INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100)"
      },
      {
        "name": "completed",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "last_accessed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "time_spent_seconds",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.favorites",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 73,
    "line_end": 82,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "entity_type",
        "type": "TEXT NOT NULL CHECK (entity_type IN ('disease', 'medication', 'protocol', 'case', 'calculator', 'article'))"
      },
      {
        "name": "entity_id",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "notes",
        "type": "TEXT"
      },
      {
        "name": "tags",
        "type": "TEXT[]"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.notes",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 87,
    "line_end": 98,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "entity_type",
        "type": "TEXT NOT NULL CHECK (entity_type IN ('disease', 'medication', 'protocol', 'case', 'patient', 'general'))"
      },
      {
        "name": "entity_id",
        "type": "TEXT"
      },
      {
        "name": "title",
        "type": "TEXT"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "tags",
        "type": "TEXT[]"
      },
      {
        "name": "is_private",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.learning_progress",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 108,
    "line_end": 123,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "path_id",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "module_id",
        "type": "TEXT"
      },
      {
        "name": "score",
        "type": "INTEGER CHECK (score >= 0 AND score <= 100)"
      },
      {
        "name": "attempts",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "time_spent_seconds",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "completed",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "last_quiz_score",
        "type": "INTEGER"
      },
      {
        "name": "quiz_history",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.quiz_attempts",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 129,
    "line_end": 139,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "quiz_id",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "module_id",
        "type": "TEXT"
      },
      {
        "name": "score",
        "type": "INTEGER NOT NULL CHECK (score >= 0 AND score <= 100)"
      },
      {
        "name": "answers",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "time_taken_seconds",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.user_xp",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 149,
    "line_end": 159,
    "columns": [
      {
        "name": "user_id",
        "type": "UUID PRIMARY KEY REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "total_xp",
        "type": "INTEGER DEFAULT 0 CHECK (total_xp >= 0)"
      },
      {
        "name": "level",
        "type": "INTEGER DEFAULT 1 CHECK (level >= 1)"
      },
      {
        "name": "current_streak",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "longest_streak",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_activity_date",
        "type": "DATE"
      },
      {
        "name": "daily_goal_met_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "weekly_goal_met_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.xp_transactions",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 162,
    "line_end": 170,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "amount",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "reason",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "entity_type",
        "type": "TEXT"
      },
      {
        "name": "entity_id",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.badges",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 175,
    "line_end": 185,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "name",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT"
      },
      {
        "name": "category",
        "type": "TEXT CHECK (category IN ('learning', 'practice', 'community', 'milestone', 'special'))"
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "rarity",
        "type": "TEXT CHECK (rarity IN ('common', 'uncommon', 'rare', 'epic', 'legendary'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.user_badges",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 188,
    "line_end": 195,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "badge_id",
        "type": "TEXT NOT NULL REFERENCES public.badges(id)"
      },
      {
        "name": "earned_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      }
    ]
  },
  {
    "table": "public.user_achievements",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 200,
    "line_end": 212,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "progress",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "target",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "completed",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.shared_cases",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 221,
    "line_end": 238,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "specialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT CHECK (difficulty IN ('beginner', 'intermediate', 'advanced', 'expert'))"
      },
      {
        "name": "case_data",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "anonymized",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "published",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "verified",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "verified_by",
        "type": "UUID REFERENCES public.users(id)"
      },
      {
        "name": "upvotes",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "downvotes",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "views",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "tags",
        "type": "TEXT[]"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.case_comments",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 244,
    "line_end": 254,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "case_id",
        "type": "UUID NOT NULL REFERENCES public.shared_cases(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "parent_id",
        "type": "UUID REFERENCES public.case_comments(id) ON DELETE CASCADE"
      },
      {
        "name": "content",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "upvotes",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_verified_answer",
        "type": "BOOLEAN DEFAULT false"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.user_sessions",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 264,
    "line_end": 274,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES public.users(id) ON DELETE CASCADE"
      },
      {
        "name": "session_start",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "session_end",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "duration_seconds",
        "type": "INTEGER"
      },
      {
        "name": "pages_visited",
        "type": "TEXT[]"
      },
      {
        "name": "actions_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "device_info",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.activity_log",
    "file": "darwin-MFC/infrastructure/supabase/schema.sql",
    "line_start": 280,
    "line_end": 290,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES public.users(id) ON DELETE SET NULL"
      },
      {
        "name": "action",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "entity_type",
        "type": "TEXT"
      },
      {
        "name": "entity_id",
        "type": "TEXT"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "ip_address",
        "type": "INET"
      },
      {
        "name": "user_agent",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "public.schema_migrations",
    "file": "darwin-MFC/infrastructure/supabase/seed.sql",
    "line_start": 55,
    "line_end": 58,
    "columns": [
      {
        "name": "version",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "applied_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_findings",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 21,
    "line_end": 49,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "text_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "text_en",
        "type": "TEXT"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "icd10_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "atc_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "tags",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnoses",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 61,
    "line_end": 93,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "name_en",
        "type": "TEXT"
      },
      {
        "name": "icd10_code",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "icd10_codes_secondary",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ("
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty_tier",
        "type": "INTEGER DEFAULT 3 CHECK (difficulty_tier >= 1 AND difficulty_tier <= 5)"
      },
      {
        "name": "keywords",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnosis_findings",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 104,
    "line_end": 128,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "diagnosis_id",
        "type": "UUID NOT NULL REFERENCES cip_diagnoses(id) ON DELETE CASCADE"
      },
      {
        "name": "finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id) ON DELETE CASCADE"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "priority",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_primary",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzles",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 139,
    "line_end": 191,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ("
      },
      {
        "name": "settings",
        "type": "JSONB NOT NULL DEFAULT '{"
      },
      {
        "name": "diagnosis_ids",
        "type": "UUID[] NOT NULL"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "options_per_section",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.1"
      },
      {
        "name": "time_limit_minutes",
        "type": "INTEGER DEFAULT 30"
      },
      {
        "name": "type",
        "type": "TEXT DEFAULT 'practice' CHECK (type IN ('practice', 'exam', 'custom'))"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzle_grid",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 203,
    "line_end": 225,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "row_index",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "correct_finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id)"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3)"
      }
    ]
  },
  {
    "table": "cip_attempts",
    "file": "infrastructure/supabase/migrations/001_cip_schema.sql",
    "line_start": 234,
    "line_end": 264,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "grid_state",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "time_per_cell",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN"
      },
      {
        "name": "correct_count",
        "type": "INTEGER"
      },
      {
        "name": "total_cells",
        "type": "INTEGER"
      },
      {
        "name": "section_breakdown",
        "type": "JSONB"
      },
      {
        "name": "diagnosis_breakdown",
        "type": "JSONB"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "ai_response_cache",
    "file": "infrastructure/supabase/migrations/003_ai_integration.sql",
    "line_start": 14,
    "line_end": 24,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "request_type",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "request_hash",
        "type": "TEXT UNIQUE NOT NULL"
      },
      {
        "name": "response_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "tokens_used",
        "type": "INTEGER"
      },
      {
        "name": "cost_brl",
        "type": "NUMERIC(10,4)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "hits",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "expires_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "knowledge_states",
    "file": "infrastructure/supabase/migrations/004_ml_feature_store.sql",
    "line_start": 7,
    "line_end": 18,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "topic",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "mastery_probability",
        "type": "NUMERIC(4,3) DEFAULT 0.1"
      },
      {
        "name": "response_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_correct_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "last_incorrect_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_predictions",
    "file": "infrastructure/supabase/migrations/004_ml_feature_store.sql",
    "line_start": 24,
    "line_end": 33,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "prediction_type",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "prediction_value",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "confidence_interval",
        "type": "JSONB"
      },
      {
        "name": "model_version",
        "type": "TEXT"
      },
      {
        "name": "features_used",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ml_feature_experiments",
    "file": "infrastructure/supabase/migrations/004_ml_feature_store.sql",
    "line_start": 39,
    "line_end": 47,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "feature",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "variant",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "outcome_metric",
        "type": "TEXT"
      },
      {
        "name": "outcome_value",
        "type": "NUMERIC"
      },
      {
        "name": "recorded_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_fsrs_weights",
    "file": "infrastructure/supabase/migrations/005_fsrs_and_cat_extensions.sql",
    "line_start": 40,
    "line_end": 48,
    "columns": [
      {
        "name": "user_id",
        "type": "UUID PRIMARY KEY REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "weights",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "training_reviews",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_optimized_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "log_loss",
        "type": "NUMERIC(6,4)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "item_exposure_log",
    "file": "infrastructure/supabase/migrations/005_fsrs_and_cat_extensions.sql",
    "line_start": 84,
    "line_end": 90,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID REFERENCES questions(id) ON DELETE CASCADE"
      },
      {
        "name": "administered_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "user_theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID REFERENCES exam_attempts(id) ON DELETE SET NULL"
      }
    ]
  },
  {
    "table": "irt_response_log",
    "file": "infrastructure/supabase/migrations/005_fsrs_and_cat_extensions.sql",
    "line_start": 118,
    "line_end": 127,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID REFERENCES questions(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "correct",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "user_theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID REFERENCES exam_attempts(id) ON DELETE SET NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "irt_calibration_batches",
    "file": "infrastructure/supabase/migrations/005_fsrs_and_cat_extensions.sql",
    "line_start": 135,
    "line_end": 147,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "batch_name",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "responses_count",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "questions_calibrated",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "model_type",
        "type": "TEXT DEFAULT '3PL'"
      },
      {
        "name": "estimation_method",
        "type": "TEXT DEFAULT 'marginal_ml'"
      },
      {
        "name": "convergence_criterion",
        "type": "NUMERIC(8,6)"
      },
      {
        "name": "iterations",
        "type": "INTEGER"
      },
      {
        "name": "log_likelihood",
        "type": "NUMERIC"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "irt_parameter_history",
    "file": "infrastructure/supabase/migrations/005_fsrs_and_cat_extensions.sql",
    "line_start": 159,
    "line_end": 176,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID REFERENCES questions(id) ON DELETE CASCADE"
      },
      {
        "name": "calibration_batch_id",
        "type": "UUID REFERENCES irt_calibration_batches(id) ON DELETE CASCADE"
      },
      {
        "name": "difficulty",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "discrimination",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "guessing",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "infit",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "outfit",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "difficulty_delta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "discrimination_delta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "access_codes",
    "file": "infrastructure/supabase/migrations/006_access_codes_and_admin.sql",
    "line_start": 15,
    "line_end": 26,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "code",
        "type": "VARCHAR(20) UNIQUE NOT NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "expires_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "max_uses",
        "type": "INTEGER DEFAULT 1"
      },
      {
        "name": "use_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "used_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "used_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'::jsonb"
      }
    ]
  },
  {
    "table": "study_activity",
    "file": "infrastructure/supabase/migrations/006_access_codes_and_admin.sql",
    "line_start": 73,
    "line_end": 84,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "activity_date",
        "type": "DATE NOT NULL"
      },
      {
        "name": "exams_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "flashcards_reviewed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "questions_answered",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "time_spent_seconds",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "question_flags",
    "file": "infrastructure/supabase/migrations/006_access_codes_and_admin.sql",
    "line_start": 180,
    "line_end": 193,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES questions(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "flag_type",
        "type": "VARCHAR(50) NOT NULL, -- 'incorrect_answer', 'unclear_stem', 'outdated_content', 'other'"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID REFERENCES exam_attempts(id)"
      },
      {
        "name": "status",
        "type": "VARCHAR(20) DEFAULT 'pending', -- 'pending', 'reviewed', 'resolved', 'dismissed'"
      },
      {
        "name": "reviewed_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "reviewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "review_notes",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_topics_generated",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 5,
    "line_end": 47,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "TEXT UNIQUE NOT NULL,  -- kebab-case like 'hipertensao-arterial'"
      },
      {
        "name": "version",
        "type": "INTEGER DEFAULT 1"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ('clinica_medica', 'cirurgia', 'pediatria', 'ginecologia_obstetricia', 'saude_coletiva'))"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ('basico', 'intermediario', 'avancado'))"
      },
      {
        "name": "definition",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "epidemiology",
        "type": "TEXT"
      },
      {
        "name": "pathophysiology",
        "type": "TEXT"
      },
      {
        "name": "clinical_presentation",
        "type": "TEXT"
      },
      {
        "name": "diagnosis",
        "type": "TEXT"
      },
      {
        "name": "treatment",
        "type": "TEXT"
      },
      {
        "name": "complications",
        "type": "TEXT"
      },
      {
        "name": "prognosis",
        "type": "TEXT"
      },
      {
        "name": "key_points",
        "type": "TEXT[] NOT NULL DEFAULT '{}'"
      },
      {
        "name": "estimated_read_time",
        "type": "INTEGER"
      },
      {
        "name": "related_disease_ids",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "related_medication_ids",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "source_disease_id",
        "type": "TEXT,  -- Darwin-MFC disease ID if generated from disease"
      },
      {
        "name": "source_type",
        "type": "TEXT CHECK (source_type IN ('darwin-mfc', 'manual', 'hybrid')) DEFAULT 'manual'"
      },
      {
        "name": "generated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "generated_by",
        "type": "TEXT,  -- User ID who initiated generation"
      },
      {
        "name": "validation_score",
        "type": "NUMERIC(3,2) CHECK (validation_score >= 0 AND validation_score <= 1)"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('draft', 'review', 'approved', 'published')) DEFAULT 'draft'"
      },
      {
        "name": "published_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "last_updated",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_citations",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 50,
    "line_end": 68,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "url",
        "type": "TEXT NOT NULL UNIQUE"
      },
      {
        "name": "title",
        "type": "TEXT"
      },
      {
        "name": "source",
        "type": "TEXT,  -- 'Diretriz SBC', 'PubMed', 'UpToDate', 'PubMed', 'Diretriz Brasileira', etc."
      },
      {
        "name": "evidence_level",
        "type": "TEXT CHECK (evidence_level IN ('A', 'B', 'C', 'unknown'))"
      },
      {
        "name": "publication_year",
        "type": "INTEGER"
      },
      {
        "name": "accessed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "is_accessible",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "accessibility_checked_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "authors",
        "type": "TEXT"
      },
      {
        "name": "journal",
        "type": "TEXT"
      },
      {
        "name": "doi",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_topic_citations",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 71,
    "line_end": 79,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "section_name",
        "type": "TEXT NOT NULL,  -- Which section uses this citation (definition, epidemiology, etc.)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_research_cache",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 82,
    "line_end": 91,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "search_query",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "results",
        "type": "JSONB NOT NULL,  -- Cached research results"
      },
      {
        "name": "cached_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "expires_at",
        "type": "TIMESTAMPTZ DEFAULT NOW() + INTERVAL '7 days'"
      }
    ]
  },
  {
    "table": "theory_generation_jobs",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 94,
    "line_end": 108,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_name",
        "type": "TEXT"
      },
      {
        "name": "total_topics",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "completed_topics",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "failed_topics",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('pending', 'running', 'completed', 'failed')) DEFAULT 'pending'"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "cost_usd",
        "type": "NUMERIC(10,4) DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_generation_job_topics",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 111,
    "line_end": 121,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "job_id",
        "type": "UUID NOT NULL REFERENCES theory_generation_jobs(id) ON DELETE CASCADE"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('pending', 'completed', 'failed')) DEFAULT 'pending'"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "cost_usd",
        "type": "NUMERIC(10,4)"
      },
      {
        "name": "generated_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "theory_validation_results",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 124,
    "line_end": 132,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "validation_stage",
        "type": "TEXT NOT NULL CHECK (validation_stage IN ('structural', 'medical', 'citations', 'readability', 'completeness'))"
      },
      {
        "name": "passed",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "score",
        "type": "NUMERIC(3,2)"
      },
      {
        "name": "issues",
        "type": "TEXT[],  -- Array of issue descriptions"
      }
    ]
  },
  {
    "table": "citation_verification_audit",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 136,
    "line_end": 161,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "is_accessible",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "http_status_code",
        "type": "INTEGER"
      },
      {
        "name": "title_match",
        "type": "BOOLEAN"
      },
      {
        "name": "extracted_title",
        "type": "TEXT"
      },
      {
        "name": "verification_score",
        "type": "NUMERIC(3,2) CHECK (verification_score >= 0 AND verification_score <= 1)"
      },
      {
        "name": "is_authoritative",
        "type": "BOOLEAN"
      },
      {
        "name": "source_type",
        "type": "TEXT CHECK (source_type IN ('brazilian_guideline', 'pubmed', 'uptodate', 'web', 'unknown'))"
      },
      {
        "name": "warnings",
        "type": "TEXT[]"
      },
      {
        "name": "verified_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "verification_method",
        "type": "TEXT CHECK (verification_method IN ('http_check', 'title_extraction', 'ai_review'))"
      },
      {
        "name": "verified_by",
        "type": "TEXT DEFAULT 'ai-system'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "hallucination_audit",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 165,
    "line_end": 192,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "section_name",
        "type": "TEXT NOT NULL CHECK (section_name IN ('definition', 'epidemiology', 'pathophysiology', 'clinicalPresentation', 'diagnosis', 'treatment', 'complications', 'prognosis'))"
      },
      {
        "name": "claim_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "claim_hash",
        "type": "TEXT,  -- Hash for deduplication"
      },
      {
        "name": "claim_supported",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "confidence",
        "type": "NUMERIC(3,2) CHECK (confidence >= 0 AND confidence <= 1)"
      },
      {
        "name": "supporting_citations",
        "type": "UUID[],  -- Array of citation IDs that support this claim"
      },
      {
        "name": "is_dangerous_claim",
        "type": "BOOLEAN DEFAULT false,  -- True if claim is about dosages, contraindications, etc."
      },
      {
        "name": "risk_level",
        "type": "TEXT CHECK (risk_level IN ('critical', 'high', 'medium', 'low')) DEFAULT 'low'"
      },
      {
        "name": "reviewed_by",
        "type": "TEXT,  -- Human reviewer if manually verified"
      },
      {
        "name": "reviewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "review_status",
        "type": "TEXT CHECK (review_status IN ('pending', 'approved', 'disputed', 'rejected'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "citation_provenance_audit",
    "file": "infrastructure/supabase/migrations/007_theory_generation_system.sql",
    "line_start": 196,
    "line_end": 210,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "hallucination_audit_id",
        "type": "UUID NOT NULL REFERENCES hallucination_audit(id) ON DELETE CASCADE"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "support_confidence",
        "type": "NUMERIC(3,2) CHECK (support_confidence >= 0 AND support_confidence <= 1)"
      },
      {
        "name": "evidence_strength",
        "type": "TEXT CHECK (evidence_strength IN ('direct', 'indirect', 'speculative'))"
      },
      {
        "name": "justification",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "infrastructure/supabase/migrations/008_cip_achievements_system.sql",
    "line_start": 16,
    "line_end": 64,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "infrastructure/supabase/migrations/008_cip_achievements_system.sql",
    "line_start": 75,
    "line_end": 95,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  },
  {
    "table": "ddl_questions",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 33,
    "line_end": 50,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "question_code",
        "type": "VARCHAR(20) UNIQUE NOT NULL"
      },
      {
        "name": "question_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "discipline",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "topic",
        "type": "VARCHAR(200) NOT NULL"
      },
      {
        "name": "subtopic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "difficulty_level",
        "type": "INTEGER CHECK (difficulty_level BETWEEN 1 AND 5)"
      },
      {
        "name": "cognitive_level",
        "type": "VARCHAR(50)"
      },
      {
        "name": "reference_answer",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "key_concepts",
        "type": "JSONB NOT NULL DEFAULT '[]'"
      },
      {
        "name": "required_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "irt_difficulty",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "irt_discrimination",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      }
    ]
  },
  {
    "table": "ddl_responses",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 53,
    "line_end": 62,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "session_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "response_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "behavioral_data",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "submitted_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "ddl_semantic_analysis",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 65,
    "line_end": 77,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_similarity_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "concept_coverage",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "detected_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "linguistic_markers",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "semantic_entropy",
        "type": "DECIMAL(8,6)"
      },
      {
        "name": "llm_raw_response",
        "type": "JSONB"
      },
      {
        "name": "llm_model_version",
        "type": "VARCHAR(50)"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_behavioral_analysis",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 80,
    "line_end": 91,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "time_to_first_keystroke_ms",
        "type": "INTEGER"
      },
      {
        "name": "hesitation_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "revision_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "anxiety_indicators",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "deviation_from_baseline",
        "type": "JSONB DEFAULT NULL"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_classification",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 94,
    "line_end": 114,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_analysis_id",
        "type": "UUID REFERENCES ddl_semantic_analysis(id)"
      },
      {
        "name": "behavioral_analysis_id",
        "type": "UUID REFERENCES ddl_behavioral_analysis(id)"
      },
      {
        "name": "secondary_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "secondary_probability",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "probabilities",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "supporting_evidence",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "classifier_version",
        "type": "VARCHAR(20) NOT NULL"
      },
      {
        "name": "classification_method",
        "type": "VARCHAR(50) DEFAULT 'fusion_probabilistic'"
      },
      {
        "name": "human_validated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "human_classification",
        "type": "lacuna_type"
      },
      {
        "name": "validator_id",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "validated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "validation_notes",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_feedback",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 117,
    "line_end": 129,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "classification_id",
        "type": "UUID NOT NULL REFERENCES ddl_classification(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "feedback_type",
        "type": "lacuna_type NOT NULL"
      },
      {
        "name": "feedback_content",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "delivered_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "viewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "user_rating",
        "type": "INTEGER CHECK (user_rating BETWEEN 1 AND 5)"
      },
      {
        "name": "user_feedback_helpful",
        "type": "BOOLEAN"
      },
      {
        "name": "user_comments",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_user_baseline",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 132,
    "line_end": 154,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE"
      },
      {
        "name": "total_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "std_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "avg_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "std_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "avg_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_semantic_similarity",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_hedging_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "calculated_from_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_calculated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "baseline_by_difficulty",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_batch_jobs",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 161,
    "line_end": 178,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_name",
        "type": "VARCHAR(100)"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "source_type",
        "type": "VARCHAR(50) NOT NULL DEFAULT 'exam'"
      },
      {
        "name": "source_id",
        "type": "UUID"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "total_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "processed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "failed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "xai_batch_id",
        "type": "VARCHAR(100)"
      },
      {
        "name": "xai_batch_status",
        "type": "VARCHAR(50)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "retry_count",
        "type": "INTEGER DEFAULT 0"
      }
    ]
  },
  {
    "table": "ddl_batch_items",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 181,
    "line_end": 191,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_job_id",
        "type": "UUID NOT NULL REFERENCES ddl_batch_jobs(id) ON DELETE CASCADE"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "classification_id",
        "type": "UUID REFERENCES ddl_classification(id)"
      },
      {
        "name": "feedback_id",
        "type": "UUID REFERENCES ddl_feedback(id)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "processed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      }
    ]
  },
  {
    "table": "exam_ddl_responses",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 194,
    "line_end": 202,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "ddl_response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "ddl_question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id)"
      },
      {
        "name": "question_order",
        "type": "INTEGER"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "exam_ddl_summary",
    "file": "infrastructure/supabase/migrations/008_ddl_full_system.sql",
    "line_start": 205,
    "line_end": 223,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL UNIQUE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "batch_job_id",
        "type": "UUID REFERENCES ddl_batch_jobs(id)"
      },
      {
        "name": "total_ddl_questions",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "analyzed_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "le_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lem_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lie_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "none_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_anxiety_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "dominant_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "overall_recommendation",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "fcr_cases",
    "file": "infrastructure/supabase/migrations/011_fractal_clinical_reasoning.sql",
    "line_start": 18,
    "line_end": 54,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "clinical_presentation_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "dados_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "padrao_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "hipotese_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "conduta_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "correct_dados",
        "type": "TEXT[] NOT NULL,       -- multiple correct findings"
      },
      {
        "name": "correct_padrao",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_hipotese",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_conduta",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "structured_explanation",
        "type": "JSONB"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.25"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,1)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "fcr_attempts",
    "file": "infrastructure/supabase/migrations/011_fractal_clinical_reasoning.sql",
    "line_start": 80,
    "line_end": 110,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "case_id",
        "type": "UUID REFERENCES fcr_cases(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "selected_dados",
        "type": "TEXT[]"
      },
      {
        "name": "selected_padrao",
        "type": "TEXT"
      },
      {
        "name": "selected_hipotese",
        "type": "TEXT"
      },
      {
        "name": "selected_conduta",
        "type": "TEXT"
      },
      {
        "name": "confidence_dados",
        "type": "INTEGER"
      },
      {
        "name": "confidence_padrao",
        "type": "INTEGER"
      },
      {
        "name": "confidence_hipotese",
        "type": "INTEGER"
      },
      {
        "name": "confidence_conduta",
        "type": "INTEGER"
      },
      {
        "name": "level_results",
        "type": "JSONB,                -- FCRLevelResult[]"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "calibration_score",
        "type": "NUMERIC(5,1),     -- 0-100"
      },
      {
        "name": "overconfidence_index",
        "type": "NUMERIC(5,3),  -- -1 to +1"
      },
      {
        "name": "detected_lacunas",
        "type": "JSONB,             -- FCRDetectedLacuna[]"
      },
      {
        "name": "step_times",
        "type": "JSONB,                   -- { dados: ms, padrao: ms, ... }"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "fcr_calibration_history",
    "file": "infrastructure/supabase/migrations/011_fractal_clinical_reasoning.sql",
    "line_start": 131,
    "line_end": 140,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "calibration_score",
        "type": "NUMERIC(5,1)"
      },
      {
        "name": "overconfidence_index",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "illusion_count",
        "type": "INTEGER DEFAULT 0,   -- high conf + wrong count"
      },
      {
        "name": "total_levels",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "recorded_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "dif_analysis_results",
    "file": "infrastructure/supabase/migrations/016_research_psychometrics.sql",
    "line_start": 17,
    "line_end": 51,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "item_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "item_type",
        "type": "TEXT NOT NULL DEFAULT 'question',  -- question | fcr_case"
      },
      {
        "name": "group_variable",
        "type": "TEXT NOT NULL,  -- 'area' | 'institution_tier' | 'gender' | 'region'"
      },
      {
        "name": "focal_group",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "reference_group",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "mh_alpha",
        "type": "NUMERIC(8,4)"
      },
      {
        "name": "mh_delta",
        "type": "NUMERIC(8,4)"
      },
      {
        "name": "mh_chi_square",
        "type": "NUMERIC(10,4)"
      },
      {
        "name": "mh_p_value",
        "type": "NUMERIC(8,6)"
      },
      {
        "name": "lord_chi_square",
        "type": "NUMERIC(10,4)"
      },
      {
        "name": "lord_p_value",
        "type": "NUMERIC(8,6)"
      },
      {
        "name": "ets_classification",
        "type": "TEXT NOT NULL DEFAULT 'A',  -- A | B | C"
      },
      {
        "name": "flagged",
        "type": "BOOLEAN NOT NULL DEFAULT FALSE"
      },
      {
        "name": "direction",
        "type": "TEXT,  -- 'favors_focal' | 'favors_reference' | 'none'"
      },
      {
        "name": "sample_size_focal",
        "type": "INTEGER NOT NULL DEFAULT 0"
      },
      {
        "name": "sample_size_reference",
        "type": "INTEGER NOT NULL DEFAULT 0"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT now()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT now()"
      }
    ]
  },
  {
    "table": "learner_model_snapshots",
    "file": "infrastructure/supabase/migrations/016_research_psychometrics.sql",
    "line_start": 63,
    "line_end": 107,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "irt_theta",
        "type": "NUMERIC(6,4) DEFAULT 0"
      },
      {
        "name": "irt_se",
        "type": "NUMERIC(6,4)"
      },
      {
        "name": "mirt_profile",
        "type": "JSONB,  -- { theta: Record<area, number>, ses: Record<area, number>, compositeTheta: number }"
      },
      {
        "name": "rt_irt_theta",
        "type": "NUMERIC(6,4)"
      },
      {
        "name": "rt_irt_tau",
        "type": "NUMERIC(6,4)"
      },
      {
        "name": "rt_irt_classification",
        "type": "TEXT,  -- 'fast_accurate' | 'slow_accurate' | 'fast_inaccurate' | 'slow_inaccurate'"
      },
      {
        "name": "bkt_mastery",
        "type": "JSONB,  -- Record<kcId, { mastery: number, classification: string }>"
      },
      {
        "name": "bkt_overall_mastery",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "hlr_average_retention",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "hlr_weights",
        "type": "JSONB,  -- number[] \u2014 learned weight vector"
      },
      {
        "name": "fcr_calibration_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "fcr_overconfidence_index",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "overall_competency",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "pass_probability",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "area_competency",
        "type": "JSONB,  -- Record<area, number>"
      },
      {
        "name": "strengths",
        "type": "JSONB,         -- string[]"
      },
      {
        "name": "weaknesses",
        "type": "JSONB,        -- string[]"
      },
      {
        "name": "recommendations",
        "type": "JSONB,   -- StudyRecommendation[]"
      },
      {
        "name": "engagement_score",
        "type": "NUMERIC(5,4)"
      },
      {
        "name": "study_streak",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "weekly_hours",
        "type": "NUMERIC(5,2) DEFAULT 0"
      },
      {
        "name": "snapshot_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT now()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT now()"
      }
    ]
  },
  {
    "table": "study_activity_log",
    "file": "infrastructure/supabase/migrations/016_research_psychometrics.sql",
    "line_start": 117,
    "line_end": 143,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "activity_type",
        "type": "TEXT NOT NULL,  -- 'exam_question' | 'flashcard_review' | 'fcr_case' | 'study_session'"
      },
      {
        "name": "item_id",
        "type": "UUID"
      },
      {
        "name": "area",
        "type": "TEXT"
      },
      {
        "name": "correct",
        "type": "BOOLEAN"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER"
      },
      {
        "name": "confidence",
        "type": "NUMERIC(3,2),  -- 0.0 to 1.0"
      },
      {
        "name": "knowledge_component",
        "type": "TEXT,  -- KC identifier for BKT"
      },
      {
        "name": "difficulty",
        "type": "NUMERIC(5,3),   -- Item difficulty at time of response"
      },
      {
        "name": "elapsed_days_since_last",
        "type": "NUMERIC(8,2),  -- Days since last review of this item"
      },
      {
        "name": "review_count",
        "type": "INTEGER DEFAULT 0,         -- Total prior reviews of this item"
      },
      {
        "name": "correct_streak",
        "type": "INTEGER DEFAULT 0,       -- Current consecutive correct count"
      },
      {
        "name": "session_id",
        "type": "UUID"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT now()"
      }
    ]
  },
  {
    "table": "flashcard_review_logs",
    "file": "infrastructure/supabase/migrations/018_flashcard_review_logs.sql",
    "line_start": 7,
    "line_end": 18,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "card_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "rating",
        "type": "SMALLINT NOT NULL CHECK (rating BETWEEN 1 AND 4)"
      },
      {
        "name": "state",
        "type": "TEXT NOT NULL CHECK (state IN ('new', 'learning', 'review', 'relearning'))"
      },
      {
        "name": "elapsed_days",
        "type": "NUMERIC(8, 2) DEFAULT 0"
      },
      {
        "name": "stability_after",
        "type": "NUMERIC(8, 3)"
      },
      {
        "name": "difficulty_after",
        "type": "NUMERIC(5, 3)"
      },
      {
        "name": "scheduled_days",
        "type": "INTEGER"
      },
      {
        "name": "reviewed_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_fsrs_weights",
    "file": "infrastructure/supabase/migrations/018_flashcard_review_logs.sql",
    "line_start": 39,
    "line_end": 47,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "weights",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "optimizer_result",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "infrastructure/supabase/migrations/20260206183256_cip_achievements.sql",
    "line_start": 16,
    "line_end": 64,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "infrastructure/supabase/migrations/20260206183256_cip_achievements.sql",
    "line_start": 75,
    "line_end": 95,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  },
  {
    "table": "ddl_questions",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 16,
    "line_end": 43,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "question_code",
        "type": "VARCHAR(20) UNIQUE NOT NULL"
      },
      {
        "name": "question_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "discipline",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "topic",
        "type": "VARCHAR(200) NOT NULL"
      },
      {
        "name": "subtopic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "difficulty_level",
        "type": "INTEGER CHECK (difficulty_level BETWEEN 1 AND 5)"
      },
      {
        "name": "cognitive_level",
        "type": "VARCHAR(50)"
      },
      {
        "name": "reference_answer",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "key_concepts",
        "type": "JSONB NOT NULL DEFAULT '[]'"
      },
      {
        "name": "required_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "irt_difficulty",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "irt_discrimination",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      }
    ]
  },
  {
    "table": "ddl_responses",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 49,
    "line_end": 70,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "session_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "response_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "response_length",
        "type": "INTEGER GENERATED ALWAYS AS (LENGTH(response_text)) STORED"
      },
      {
        "name": "word_count",
        "type": "INTEGER GENERATED ALWAYS AS ("
      },
      {
        "name": "behavioral_data",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "submitted_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "ddl_semantic_analysis",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 76,
    "line_end": 100,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_similarity_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "concept_coverage",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "detected_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "linguistic_markers",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "semantic_entropy",
        "type": "DECIMAL(8,6)"
      },
      {
        "name": "llm_raw_response",
        "type": "JSONB"
      },
      {
        "name": "llm_model_version",
        "type": "VARCHAR(50)"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_behavioral_analysis",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 106,
    "line_end": 128,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "time_to_first_keystroke_ms",
        "type": "INTEGER"
      },
      {
        "name": "hesitation_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "revision_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "anxiety_indicators",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "deviation_from_baseline",
        "type": "JSONB DEFAULT NULL"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_classification",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 134,
    "line_end": 167,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_analysis_id",
        "type": "UUID REFERENCES ddl_semantic_analysis(id)"
      },
      {
        "name": "behavioral_analysis_id",
        "type": "UUID REFERENCES ddl_behavioral_analysis(id)"
      },
      {
        "name": "secondary_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "secondary_probability",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "probabilities",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "supporting_evidence",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "classifier_version",
        "type": "VARCHAR(20) NOT NULL"
      },
      {
        "name": "classification_method",
        "type": "VARCHAR(50) DEFAULT 'fusion_probabilistic'"
      },
      {
        "name": "human_validated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "human_classification",
        "type": "lacuna_type"
      },
      {
        "name": "validator_id",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "validated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "validation_notes",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_feedback",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 173,
    "line_end": 192,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "classification_id",
        "type": "UUID NOT NULL REFERENCES ddl_classification(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "feedback_type",
        "type": "lacuna_type NOT NULL"
      },
      {
        "name": "feedback_content",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "delivered_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "viewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "user_rating",
        "type": "INTEGER CHECK (user_rating BETWEEN 1 AND 5)"
      },
      {
        "name": "user_feedback_helpful",
        "type": "BOOLEAN"
      },
      {
        "name": "user_comments",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_user_baseline",
    "file": "infrastructure/supabase/migrations/ddl/001_ddl_core_tables.sql",
    "line_start": 198,
    "line_end": 237,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "total_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "std_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "avg_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "std_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "avg_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_semantic_similarity",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_hedging_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "calculated_from_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_calculated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "baseline_by_difficulty",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_batch_jobs",
    "file": "infrastructure/supabase/migrations/ddl/002_ddl_batch_processing.sql",
    "line_start": 13,
    "line_end": 42,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_name",
        "type": "VARCHAR(100)"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "source_type",
        "type": "VARCHAR(50) NOT NULL DEFAULT 'exam'"
      },
      {
        "name": "source_id",
        "type": "UUID, -- exam_attempt_id if from exam"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "total_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "processed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "failed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "xai_batch_id",
        "type": "VARCHAR(100)"
      },
      {
        "name": "xai_batch_status",
        "type": "VARCHAR(50)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "retry_count",
        "type": "INTEGER DEFAULT 0"
      }
    ]
  },
  {
    "table": "ddl_batch_items",
    "file": "infrastructure/supabase/migrations/ddl/002_ddl_batch_processing.sql",
    "line_start": 48,
    "line_end": 68,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_job_id",
        "type": "UUID NOT NULL REFERENCES ddl_batch_jobs(id) ON DELETE CASCADE"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "classification_id",
        "type": "UUID REFERENCES ddl_classification(id)"
      },
      {
        "name": "feedback_id",
        "type": "UUID REFERENCES ddl_feedback(id)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "processed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      }
    ]
  },
  {
    "table": "exam_ddl_responses",
    "file": "infrastructure/supabase/migrations/ddl/002_ddl_batch_processing.sql",
    "line_start": 74,
    "line_end": 89,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL, -- References exam_attempts but not enforced for flexibility"
      },
      {
        "name": "ddl_response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "ddl_question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id)"
      },
      {
        "name": "question_order",
        "type": "INTEGER"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "exam_ddl_summary",
    "file": "infrastructure/supabase/migrations/ddl/002_ddl_batch_processing.sql",
    "line_start": 95,
    "line_end": 125,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL UNIQUE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "batch_job_id",
        "type": "UUID REFERENCES ddl_batch_jobs(id)"
      },
      {
        "name": "total_ddl_questions",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "analyzed_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "le_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lem_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lie_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "none_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_anxiety_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "dominant_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "overall_recommendation",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_corpus_questions",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 91,
    "line_end": 147,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "source",
        "type": "question_source NOT NULL"
      },
      {
        "name": "source_year",
        "type": "INTEGER"
      },
      {
        "name": "source_exam",
        "type": "VARCHAR(100)"
      },
      {
        "name": "original_number",
        "type": "INTEGER"
      },
      {
        "name": "external_id",
        "type": "VARCHAR(100)"
      },
      {
        "name": "full_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "stem",
        "type": "TEXT NOT NULL,  -- Enunciado sem alternativas"
      },
      {
        "name": "alternatives",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "correct_answer",
        "type": "CHAR(1) NOT NULL"
      },
      {
        "name": "explanation",
        "type": "TEXT"
      },
      {
        "name": "question_type",
        "type": "question_type NOT NULL"
      },
      {
        "name": "secondary_area",
        "type": "VARCHAR(100)"
      },
      {
        "name": "topic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "subtopic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "extracted_features",
        "type": "JSONB"
      },
      {
        "name": "embedding",
        "type": "vector(1536),  -- OpenAI ada-002 ou similar"
      },
      {
        "name": "has_image",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "has_table",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "has_lab_values",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "word_count",
        "type": "INTEGER"
      },
      {
        "name": "irt_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "irt_discrimination",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "irt_guessing",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "search_vector",
        "type": "tsvector GENERATED ALWAYS AS ("
      }
    ]
  },
  {
    "table": "qgen_structural_features",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 163,
    "line_end": 203,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_corpus_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "stem_word_count",
        "type": "INTEGER"
      },
      {
        "name": "stem_sentence_count",
        "type": "INTEGER"
      },
      {
        "name": "stem_char_count",
        "type": "INTEGER"
      },
      {
        "name": "avg_words_per_sentence",
        "type": "DECIMAL(5,2)"
      },
      {
        "name": "num_alternatives",
        "type": "INTEGER"
      },
      {
        "name": "alternatives_word_counts",
        "type": "JSONB,  -- {\"A\": 12, \"B\": 15, ...}"
      },
      {
        "name": "alternatives_length_variance",
        "type": "DECIMAL(5,2)"
      },
      {
        "name": "longest_alternative",
        "type": "CHAR(1)"
      },
      {
        "name": "shortest_alternative",
        "type": "CHAR(1)"
      },
      {
        "name": "has_patient_demographics",
        "type": "BOOLEAN"
      },
      {
        "name": "has_chief_complaint",
        "type": "BOOLEAN"
      },
      {
        "name": "has_time_evolution",
        "type": "BOOLEAN"
      },
      {
        "name": "has_physical_exam",
        "type": "BOOLEAN"
      },
      {
        "name": "has_vital_signs",
        "type": "BOOLEAN"
      },
      {
        "name": "has_lab_results",
        "type": "BOOLEAN"
      },
      {
        "name": "has_imaging",
        "type": "BOOLEAN"
      },
      {
        "name": "has_pathology",
        "type": "BOOLEAN"
      },
      {
        "name": "has_medication_history",
        "type": "BOOLEAN"
      },
      {
        "name": "has_family_history",
        "type": "BOOLEAN"
      },
      {
        "name": "has_social_history",
        "type": "BOOLEAN"
      },
      {
        "name": "question_format",
        "type": "VARCHAR(50),  -- \"Qual\", \"O que\", \"Como\", etc."
      },
      {
        "name": "is_negative_stem",
        "type": "BOOLEAN,     -- \"EXCETO\", \"N\u00c3O\", \"INCORRETA\""
      },
      {
        "name": "asks_for_diagnosis",
        "type": "BOOLEAN"
      },
      {
        "name": "asks_for_treatment",
        "type": "BOOLEAN"
      },
      {
        "name": "asks_for_next_step",
        "type": "BOOLEAN"
      },
      {
        "name": "asks_for_mechanism",
        "type": "BOOLEAN"
      },
      {
        "name": "asks_for_prognosis",
        "type": "BOOLEAN"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_clinical_features",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 206,
    "line_end": 249,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_corpus_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "patient_sex",
        "type": "VARCHAR(20),       -- Masculino, Feminino, N\u00e3o especificado"
      },
      {
        "name": "patient_age_value",
        "type": "INTEGER"
      },
      {
        "name": "patient_age_unit",
        "type": "VARCHAR(20),  -- anos, meses, dias"
      },
      {
        "name": "patient_age_category",
        "type": "VARCHAR(30),  -- Neonato, Lactente, Crian\u00e7a, Adolescente, Adulto, Idoso"
      },
      {
        "name": "patient_occupation",
        "type": "VARCHAR(100)"
      },
      {
        "name": "patient_ethnicity",
        "type": "VARCHAR(50)"
      },
      {
        "name": "clinical_scenario",
        "type": "clinical_scenario"
      },
      {
        "name": "urgency_level",
        "type": "VARCHAR(20),     -- Eletivo, Urgente, Emergente"
      },
      {
        "name": "chief_complaint",
        "type": "TEXT"
      },
      {
        "name": "time_evolution_value",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "time_evolution_unit",
        "type": "VARCHAR(20),  -- minutos, horas, dias, semanas, meses, anos"
      },
      {
        "name": "is_acute",
        "type": "BOOLEAN"
      },
      {
        "name": "is_chronic",
        "type": "BOOLEAN"
      },
      {
        "name": "is_recurrent",
        "type": "BOOLEAN"
      },
      {
        "name": "vital_signs",
        "type": "JSONB"
      },
      {
        "name": "physical_exam_systems",
        "type": "JSONB,  -- [\"cardiovascular\", \"respirat\u00f3rio\", ...]"
      },
      {
        "name": "physical_exam_findings",
        "type": "JSONB, -- {\"cardiovascular\": \"sopro sist\u00f3lico\", ...}"
      },
      {
        "name": "lab_tests",
        "type": "JSONB"
      },
      {
        "name": "imaging_tests",
        "type": "JSONB"
      },
      {
        "name": "other_tests",
        "type": "JSONB"
      },
      {
        "name": "differential_diagnoses",
        "type": "JSONB"
      },
      {
        "name": "icd10_codes",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_cognitive_features",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 252,
    "line_end": 298,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_corpus_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "bloom_level",
        "type": "bloom_level"
      },
      {
        "name": "bloom_confidence",
        "type": "DECIMAL(3,2)"
      },
      {
        "name": "requires_recall",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_understanding",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_application",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_analysis",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_synthesis",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_evaluation",
        "type": "BOOLEAN"
      },
      {
        "name": "tests_factual_knowledge",
        "type": "BOOLEAN"
      },
      {
        "name": "tests_conceptual_knowledge",
        "type": "BOOLEAN"
      },
      {
        "name": "tests_procedural_knowledge",
        "type": "BOOLEAN"
      },
      {
        "name": "tests_metacognitive_knowledge",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_calculation",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_interpretation",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_clinical_reasoning",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_ethical_reasoning",
        "type": "BOOLEAN"
      },
      {
        "name": "requires_integration",
        "type": "BOOLEAN"
      },
      {
        "name": "key_concepts",
        "type": "JSONB"
      },
      {
        "name": "required_integrations",
        "type": "JSONB"
      },
      {
        "name": "prerequisite_concepts",
        "type": "JSONB"
      },
      {
        "name": "concept_count",
        "type": "INTEGER"
      },
      {
        "name": "integration_count",
        "type": "INTEGER"
      },
      {
        "name": "cognitive_load_estimate",
        "type": "DECIMAL(3,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_linguistic_features",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 301,
    "line_end": 341,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_corpus_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "stem_hedging_count",
        "type": "INTEGER"
      },
      {
        "name": "stem_hedging_markers",
        "type": "JSONB,  -- [\"pode\", \"geralmente\", \"frequentemente\"]"
      },
      {
        "name": "stem_absolute_count",
        "type": "INTEGER"
      },
      {
        "name": "stem_absolute_markers",
        "type": "JSONB,  -- [\"sempre\", \"nunca\", \"\u00fanico\"]"
      },
      {
        "name": "logical_connectives",
        "type": "JSONB,  -- [\"portanto\", \"entretanto\", \"al\u00e9m disso\"]"
      },
      {
        "name": "alternatives_linguistic",
        "type": "JSONB"
      },
      {
        "name": "grammatical_cues",
        "type": "JSONB,  -- Concord\u00e2ncia que revela resposta"
      },
      {
        "name": "length_cue_present",
        "type": "BOOLEAN,  -- Alternativa correta muito maior/menor"
      },
      {
        "name": "absolute_term_in_correct",
        "type": "BOOLEAN,  -- Termo absoluto na correta (problema)"
      },
      {
        "name": "flesch_reading_ease",
        "type": "DECIMAL(5,2)"
      },
      {
        "name": "gunning_fog_index",
        "type": "DECIMAL(5,2)"
      },
      {
        "name": "avg_syllables_per_word",
        "type": "DECIMAL(4,2)"
      },
      {
        "name": "technical_term_density",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "medical_terms",
        "type": "JSONB"
      },
      {
        "name": "abbreviations",
        "type": "JSONB"
      },
      {
        "name": "eponyms",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_distractor_features",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 344,
    "line_end": 382,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_corpus_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "alternative",
        "type": "CHAR(1) NOT NULL"
      },
      {
        "name": "is_correct",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "distractor_type",
        "type": "distractor_type"
      },
      {
        "name": "distractor_type_confidence",
        "type": "DECIMAL(3,2)"
      },
      {
        "name": "plausibility_score",
        "type": "DECIMAL(3,2),  -- 0-1"
      },
      {
        "name": "semantic_similarity_to_correct",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "shares_key_concepts",
        "type": "BOOLEAN"
      },
      {
        "name": "concept_overlap_count",
        "type": "INTEGER"
      },
      {
        "name": "targets_misconception",
        "type": "BOOLEAN"
      },
      {
        "name": "misconception_id",
        "type": "UUID,  -- FK para tabela de misconceptions"
      },
      {
        "name": "misconception_description",
        "type": "TEXT"
      },
      {
        "name": "is_valid_but_not_best",
        "type": "BOOLEAN"
      },
      {
        "name": "is_contraindicated",
        "type": "BOOLEAN"
      },
      {
        "name": "is_outdated",
        "type": "BOOLEAN"
      },
      {
        "name": "is_incomplete",
        "type": "BOOLEAN"
      },
      {
        "name": "selection_rate",
        "type": "DECIMAL(4,3),  -- % que escolheu esta alternativa"
      },
      {
        "name": "discrimination_index",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "point_biserial",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_medical_areas",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 389,
    "line_end": 404,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name",
        "type": "VARCHAR(100) NOT NULL UNIQUE"
      },
      {
        "name": "parent_id",
        "type": "UUID REFERENCES qgen_medical_areas(id)"
      },
      {
        "name": "enamed_weight",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "enare_weight",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "dcn_reference",
        "type": "TEXT,  -- Refer\u00eancia nas DCN"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_topics",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 407,
    "line_end": 428,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "area_id",
        "type": "UUID NOT NULL REFERENCES qgen_medical_areas(id)"
      },
      {
        "name": "name",
        "type": "VARCHAR(200) NOT NULL"
      },
      {
        "name": "key_concepts",
        "type": "JSONB"
      },
      {
        "name": "frequency_score",
        "type": "DECIMAL(3,2),  -- 0-1, baseado em corpus"
      },
      {
        "name": "typical_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "common_integrations",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_misconceptions",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 431,
    "line_end": 460,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "code",
        "type": "VARCHAR(50) UNIQUE"
      },
      {
        "name": "name",
        "type": "VARCHAR(200) NOT NULL"
      },
      {
        "name": "area_id",
        "type": "UUID REFERENCES qgen_medical_areas(id)"
      },
      {
        "name": "topic_id",
        "type": "UUID REFERENCES qgen_topics(id)"
      },
      {
        "name": "incorrect_belief",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_understanding",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "why_common",
        "type": "TEXT,  -- Por que \u00e9 um erro comum"
      },
      {
        "name": "concepts_involved",
        "type": "JSONB"
      },
      {
        "name": "prevalence_estimate",
        "type": "DECIMAL(3,2),  -- % de estudantes que t\u00eam"
      },
      {
        "name": "source_studies",
        "type": "JSONB"
      },
      {
        "name": "correction_strategies",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_vignette_templates",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 463,
    "line_end": 485,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "clinical_scenario",
        "type": "clinical_scenario NOT NULL"
      },
      {
        "name": "template_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "required_fields",
        "type": "JSONB"
      },
      {
        "name": "optional_fields",
        "type": "JSONB"
      },
      {
        "name": "applicable_areas",
        "type": "JSONB"
      },
      {
        "name": "examples",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_generated_questions",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 492,
    "line_end": 551,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "generation_config_id",
        "type": "UUID,  -- FK para config usada"
      },
      {
        "name": "generation_timestamp",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "stem",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "alternatives",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "correct_answer",
        "type": "CHAR(1) NOT NULL"
      },
      {
        "name": "explanation",
        "type": "TEXT"
      },
      {
        "name": "target_area",
        "type": "VARCHAR(100)"
      },
      {
        "name": "target_topic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "target_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "target_bloom_level",
        "type": "bloom_level"
      },
      {
        "name": "generated_features",
        "type": "JSONB"
      },
      {
        "name": "embedding",
        "type": "vector(1536)"
      },
      {
        "name": "validation_status",
        "type": "validation_status DEFAULT 'DRAFT'"
      },
      {
        "name": "quality_scores",
        "type": "JSONB"
      },
      {
        "name": "max_corpus_similarity",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "most_similar_corpus_id",
        "type": "UUID"
      },
      {
        "name": "estimated_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "estimated_discrimination",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "reviewer_id",
        "type": "UUID"
      },
      {
        "name": "review_timestamp",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "review_notes",
        "type": "TEXT"
      },
      {
        "name": "review_score",
        "type": "INTEGER,  -- 1-5"
      },
      {
        "name": "llm_model",
        "type": "VARCHAR(100)"
      },
      {
        "name": "llm_prompt_version",
        "type": "VARCHAR(50)"
      },
      {
        "name": "llm_raw_response",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_generation_log",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 560,
    "line_end": 579,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID REFERENCES qgen_generated_questions(id)"
      },
      {
        "name": "request_params",
        "type": "JSONB"
      },
      {
        "name": "prompt_used",
        "type": "TEXT"
      },
      {
        "name": "llm_response",
        "type": "TEXT"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER"
      },
      {
        "name": "tokens_used",
        "type": "INTEGER"
      },
      {
        "name": "success",
        "type": "BOOLEAN"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_human_reviews",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 586,
    "line_end": 612,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_generated_questions(id)"
      },
      {
        "name": "reviewer_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "medical_accuracy_score",
        "type": "INTEGER CHECK (medical_accuracy_score BETWEEN 1 AND 5)"
      },
      {
        "name": "clinical_relevance_score",
        "type": "INTEGER CHECK (clinical_relevance_score BETWEEN 1 AND 5)"
      },
      {
        "name": "linguistic_clarity_score",
        "type": "INTEGER CHECK (linguistic_clarity_score BETWEEN 1 AND 5)"
      },
      {
        "name": "distractor_quality_score",
        "type": "INTEGER CHECK (distractor_quality_score BETWEEN 1 AND 5)"
      },
      {
        "name": "difficulty_appropriate_score",
        "type": "INTEGER CHECK (difficulty_appropriate_score BETWEEN 1 AND 5)"
      },
      {
        "name": "overall_score",
        "type": "INTEGER CHECK (overall_score BETWEEN 1 AND 5)"
      },
      {
        "name": "medical_issues",
        "type": "TEXT"
      },
      {
        "name": "linguistic_issues",
        "type": "TEXT"
      },
      {
        "name": "suggested_changes",
        "type": "TEXT"
      },
      {
        "name": "decision",
        "type": "VARCHAR(20),  -- approve, reject, revise"
      },
      {
        "name": "review_duration_seconds",
        "type": "INTEGER"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_pilot_results",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 615,
    "line_end": 646,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES qgen_generated_questions(id)"
      },
      {
        "name": "pilot_session_id",
        "type": "UUID"
      },
      {
        "name": "total_responses",
        "type": "INTEGER"
      },
      {
        "name": "correct_responses",
        "type": "INTEGER"
      },
      {
        "name": "response_distribution",
        "type": "JSONB,  -- {\"A\": 0.15, \"B\": 0.25, \"C\": 0.45, \"D\": 0.15}"
      },
      {
        "name": "irt_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "irt_discrimination",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "irt_guessing",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "distractor_analysis",
        "type": "JSONB"
      },
      {
        "name": "avg_response_time_seconds",
        "type": "DECIMAL(6,2)"
      },
      {
        "name": "median_response_time_seconds",
        "type": "DECIMAL(6,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "qgen_generation_config",
    "file": "infrastructure/supabase/migrations/qgen/001_qgen_core_tables.sql",
    "line_start": 652,
    "line_end": 685,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "target_area",
        "type": "VARCHAR(100)"
      },
      {
        "name": "target_topic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "target_difficulty",
        "type": "DECIMAL(4,3)"
      },
      {
        "name": "target_bloom_level",
        "type": "bloom_level"
      },
      {
        "name": "target_question_type",
        "type": "question_type"
      },
      {
        "name": "llm_model",
        "type": "VARCHAR(100) DEFAULT 'grok-3'"
      },
      {
        "name": "llm_temperature",
        "type": "DECIMAL(3,2) DEFAULT 0.7"
      },
      {
        "name": "llm_max_tokens",
        "type": "INTEGER DEFAULT 2048"
      },
      {
        "name": "prompt_version",
        "type": "VARCHAR(50)"
      },
      {
        "name": "use_few_shot",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "few_shot_count",
        "type": "INTEGER DEFAULT 3"
      },
      {
        "name": "min_quality_score",
        "type": "DECIMAL(3,2) DEFAULT 0.70"
      },
      {
        "name": "max_corpus_similarity",
        "type": "DECIMAL(3,2) DEFAULT 0.85"
      },
      {
        "name": "require_human_review",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_by",
        "type": "UUID"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_findings",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 13,
    "line_end": 27,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "text_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "text_en",
        "type": "TEXT"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "icd10_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "atc_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "tags",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnoses",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 35,
    "line_end": 50,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "name_en",
        "type": "TEXT"
      },
      {
        "name": "icd10_code",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "icd10_codes_secondary",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ("
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty_tier",
        "type": "INTEGER DEFAULT 3 CHECK (difficulty_tier >= 1 AND difficulty_tier <= 5)"
      },
      {
        "name": "keywords",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnosis_findings",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 57,
    "line_end": 68,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "diagnosis_id",
        "type": "UUID NOT NULL REFERENCES cip_diagnoses(id) ON DELETE CASCADE"
      },
      {
        "name": "finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id) ON DELETE CASCADE"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "priority",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_primary",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzles",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 75,
    "line_end": 104,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ("
      },
      {
        "name": "settings",
        "type": "JSONB NOT NULL DEFAULT '{"
      },
      {
        "name": "diagnosis_ids",
        "type": "UUID[] NOT NULL"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "options_per_section",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.1"
      },
      {
        "name": "time_limit_minutes",
        "type": "INTEGER DEFAULT 30"
      },
      {
        "name": "type",
        "type": "TEXT DEFAULT 'practice' CHECK (type IN ('practice', 'exam', 'custom'))"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzle_grid",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 112,
    "line_end": 122,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "row_index",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "correct_finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id)"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3)"
      }
    ]
  },
  {
    "table": "cip_attempts",
    "file": "infrastructure/supabase/run_cip_migration.sql",
    "line_start": 127,
    "line_end": 145,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "grid_state",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "time_per_cell",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN"
      },
      {
        "name": "correct_count",
        "type": "INTEGER"
      },
      {
        "name": "total_cells",
        "type": "INTEGER"
      },
      {
        "name": "section_breakdown",
        "type": "JSONB"
      },
      {
        "name": "diagnosis_breakdown",
        "type": "JSONB"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "profiles",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 14,
    "line_end": 35,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "email",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "full_name",
        "type": "TEXT"
      },
      {
        "name": "avatar_url",
        "type": "TEXT"
      },
      {
        "name": "xp",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "level",
        "type": "INTEGER DEFAULT 1"
      },
      {
        "name": "streak_days",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_activity_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "subscription_tier",
        "type": "TEXT DEFAULT 'free' CHECK (subscription_tier IN ('free', 'premium', 'institutional'))"
      },
      {
        "name": "subscription_expires_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "preferences",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "question_banks",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 41,
    "line_end": 55,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "source",
        "type": "TEXT NOT NULL CHECK (source IN ('official_enamed', 'residencia', 'concurso', 'ai_generated', 'community'))"
      },
      {
        "name": "year_start",
        "type": "INTEGER"
      },
      {
        "name": "year_end",
        "type": "INTEGER"
      },
      {
        "name": "question_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "areas",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_premium",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "questions",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 61,
    "line_end": 98,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "bank_id",
        "type": "UUID REFERENCES question_banks(id) ON DELETE CASCADE"
      },
      {
        "name": "stem",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "options",
        "type": "JSONB NOT NULL, -- Array of {letter, text, feedback}"
      },
      {
        "name": "correct_index",
        "type": "INTEGER NOT NULL CHECK (correct_index >= 0 AND correct_index <= 4)"
      },
      {
        "name": "explanation",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0,     -- b parameter"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1, -- a parameter"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.25,    -- c parameter"
      },
      {
        "name": "irt_infit",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "irt_outfit",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ('clinica_medica', 'cirurgia', 'ginecologia_obstetricia', 'pediatria', 'saude_coletiva'))"
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "topic",
        "type": "TEXT"
      },
      {
        "name": "icd10_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "atc_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "year",
        "type": "INTEGER"
      },
      {
        "name": "difficulty",
        "type": "TEXT CHECK (difficulty IN ('muito_facil', 'facil', 'medio', 'dificil', 'muito_dificil'))"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "reference_list",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "times_answered",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_correct",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "exams",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 111,
    "line_end": 124,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "question_count",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "time_limit_minutes",
        "type": "INTEGER NOT NULL DEFAULT 300, -- 5 hours for ENAMED"
      },
      {
        "name": "question_ids",
        "type": "UUID[] NOT NULL"
      },
      {
        "name": "type",
        "type": "TEXT NOT NULL CHECK (type IN ('official_simulation', 'custom', 'practice', 'review'))"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "exam_attempts",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 133,
    "line_end": 156,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "exam_id",
        "type": "UUID REFERENCES exams(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "answers",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "marked_for_review",
        "type": "UUID[] DEFAULT '{}'"
      },
      {
        "name": "time_per_question",
        "type": "JSONB DEFAULT '{}', -- question_id -> seconds"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN"
      },
      {
        "name": "correct_count",
        "type": "INTEGER"
      },
      {
        "name": "area_breakdown",
        "type": "JSONB"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "flashcard_decks",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 166,
    "line_end": 177,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "name",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "area",
        "type": "TEXT"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "card_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "flashcards",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 179,
    "line_end": 194,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "deck_id",
        "type": "UUID REFERENCES flashcard_decks(id) ON DELETE CASCADE"
      },
      {
        "name": "front",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "back",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "question_id",
        "type": "UUID REFERENCES questions(id) ON DELETE SET NULL"
      },
      {
        "name": "area",
        "type": "TEXT"
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "topic",
        "type": "TEXT"
      },
      {
        "name": "tags",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "flashcard_sm2_states",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 200,
    "line_end": 212,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "card_id",
        "type": "UUID REFERENCES flashcards(id) ON DELETE CASCADE"
      },
      {
        "name": "ease_factor",
        "type": "NUMERIC(4,2) DEFAULT 2.5"
      },
      {
        "name": "interval_days",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "repetitions",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "next_review_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "last_review_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "study_paths",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 221,
    "line_end": 233,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "estimated_hours",
        "type": "NUMERIC(5,1)"
      },
      {
        "name": "difficulty",
        "type": "TEXT CHECK (difficulty IN ('muito_facil', 'facil', 'medio', 'dificil', 'muito_dificil'))"
      },
      {
        "name": "prerequisites",
        "type": "UUID[] DEFAULT '{}'"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "study_modules",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 235,
    "line_end": 248,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "path_id",
        "type": "UUID REFERENCES study_paths(id) ON DELETE CASCADE"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "type",
        "type": "TEXT NOT NULL CHECK (type IN ('reading', 'video', 'quiz', 'flashcards', 'case_study'))"
      },
      {
        "name": "content",
        "type": "TEXT"
      },
      {
        "name": "estimated_minutes",
        "type": "INTEGER"
      },
      {
        "name": "question_ids",
        "type": "UUID[] DEFAULT '{}'"
      },
      {
        "name": "flashcard_ids",
        "type": "UUID[] DEFAULT '{}'"
      },
      {
        "name": "order_index",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_path_progress",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 253,
    "line_end": 264,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "path_id",
        "type": "UUID REFERENCES study_paths(id) ON DELETE CASCADE"
      },
      {
        "name": "completed_modules",
        "type": "UUID[] DEFAULT '{}'"
      },
      {
        "name": "current_module_id",
        "type": "UUID REFERENCES study_modules(id)"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "achievements",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 270,
    "line_end": 277,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "name",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "icon",
        "type": "TEXT"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "category",
        "type": "TEXT CHECK (category IN ('learning', 'streak', 'exam', 'social', 'milestone'))"
      }
    ]
  },
  {
    "table": "user_achievements",
    "file": "infrastructure/supabase/schema.sql",
    "line_start": 279,
    "line_end": 286,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT REFERENCES achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "earned_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_questions",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 16,
    "line_end": 43,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "question_code",
        "type": "VARCHAR(20) UNIQUE NOT NULL"
      },
      {
        "name": "question_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "discipline",
        "type": "VARCHAR(100) NOT NULL"
      },
      {
        "name": "topic",
        "type": "VARCHAR(200) NOT NULL"
      },
      {
        "name": "subtopic",
        "type": "VARCHAR(200)"
      },
      {
        "name": "difficulty_level",
        "type": "INTEGER CHECK (difficulty_level BETWEEN 1 AND 5)"
      },
      {
        "name": "cognitive_level",
        "type": "VARCHAR(50)"
      },
      {
        "name": "reference_answer",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "key_concepts",
        "type": "JSONB NOT NULL DEFAULT '[]'"
      },
      {
        "name": "required_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "irt_difficulty",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "irt_discrimination",
        "type": "DECIMAL(5,3)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      }
    ]
  },
  {
    "table": "ddl_responses",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 49,
    "line_end": 70,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id) ON DELETE CASCADE"
      },
      {
        "name": "session_id",
        "type": "UUID NOT NULL"
      },
      {
        "name": "response_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "response_length",
        "type": "INTEGER GENERATED ALWAYS AS (LENGTH(response_text)) STORED"
      },
      {
        "name": "word_count",
        "type": "INTEGER GENERATED ALWAYS AS ("
      },
      {
        "name": "behavioral_data",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "submitted_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "ddl_semantic_analysis",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 76,
    "line_end": 100,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_similarity_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "concept_coverage",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "detected_integrations",
        "type": "JSONB DEFAULT '[]'"
      },
      {
        "name": "linguistic_markers",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "semantic_entropy",
        "type": "DECIMAL(8,6)"
      },
      {
        "name": "llm_raw_response",
        "type": "JSONB"
      },
      {
        "name": "llm_model_version",
        "type": "VARCHAR(50)"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_behavioral_analysis",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 106,
    "line_end": 128,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "response_time_ms",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "time_to_first_keystroke_ms",
        "type": "INTEGER"
      },
      {
        "name": "hesitation_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "revision_pattern",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "anxiety_indicators",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "deviation_from_baseline",
        "type": "JSONB DEFAULT NULL"
      },
      {
        "name": "analyzed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_classification",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 134,
    "line_end": 167,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "semantic_analysis_id",
        "type": "UUID REFERENCES ddl_semantic_analysis(id)"
      },
      {
        "name": "behavioral_analysis_id",
        "type": "UUID REFERENCES ddl_behavioral_analysis(id)"
      },
      {
        "name": "secondary_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "secondary_probability",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "probabilities",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "supporting_evidence",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "classifier_version",
        "type": "VARCHAR(20) NOT NULL"
      },
      {
        "name": "classification_method",
        "type": "VARCHAR(50) DEFAULT 'fusion_probabilistic'"
      },
      {
        "name": "human_validated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "human_classification",
        "type": "lacuna_type"
      },
      {
        "name": "validator_id",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "validated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "validation_notes",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_feedback",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 173,
    "line_end": 192,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "classification_id",
        "type": "UUID NOT NULL REFERENCES ddl_classification(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "feedback_type",
        "type": "lacuna_type NOT NULL"
      },
      {
        "name": "feedback_content",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "delivered_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "viewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "user_rating",
        "type": "INTEGER CHECK (user_rating BETWEEN 1 AND 5)"
      },
      {
        "name": "user_feedback_helpful",
        "type": "BOOLEAN"
      },
      {
        "name": "user_comments",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_user_baseline",
    "file": "infrastructure/supabase/supabase/migrations/20260201190001_ddl_core_tables.sql",
    "line_start": 198,
    "line_end": 237,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE"
      },
      {
        "name": "total_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "std_response_time_ms",
        "type": "DECIMAL(10,2)"
      },
      {
        "name": "avg_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "std_time_per_word_ms",
        "type": "DECIMAL(8,2)"
      },
      {
        "name": "avg_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_hesitation_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_pause_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "std_revision_ratio",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_semantic_similarity",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_hedging_index",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "calculated_from_responses",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "last_calculated_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "baseline_by_difficulty",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "ddl_batch_jobs",
    "file": "infrastructure/supabase/supabase/migrations/20260201190002_ddl_batch_processing.sql",
    "line_start": 13,
    "line_end": 42,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_name",
        "type": "VARCHAR(100)"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES auth.users(id)"
      },
      {
        "name": "source_type",
        "type": "VARCHAR(50) NOT NULL DEFAULT 'exam'"
      },
      {
        "name": "source_id",
        "type": "UUID, -- exam_attempt_id if from exam"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "total_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "processed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "failed_items",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "xai_batch_id",
        "type": "VARCHAR(100)"
      },
      {
        "name": "xai_batch_status",
        "type": "VARCHAR(50)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "retry_count",
        "type": "INTEGER DEFAULT 0"
      }
    ]
  },
  {
    "table": "ddl_batch_items",
    "file": "infrastructure/supabase/supabase/migrations/20260201190002_ddl_batch_processing.sql",
    "line_start": 48,
    "line_end": 68,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_job_id",
        "type": "UUID NOT NULL REFERENCES ddl_batch_jobs(id) ON DELETE CASCADE"
      },
      {
        "name": "response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "status",
        "type": "ddl_batch_status DEFAULT 'pending'"
      },
      {
        "name": "classification_id",
        "type": "UUID REFERENCES ddl_classification(id)"
      },
      {
        "name": "feedback_id",
        "type": "UUID REFERENCES ddl_feedback(id)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "processed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      }
    ]
  },
  {
    "table": "exam_ddl_responses",
    "file": "infrastructure/supabase/supabase/migrations/20260201190002_ddl_batch_processing.sql",
    "line_start": 74,
    "line_end": 89,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL, -- References exam_attempts but not enforced for flexibility"
      },
      {
        "name": "ddl_response_id",
        "type": "UUID NOT NULL REFERENCES ddl_responses(id) ON DELETE CASCADE"
      },
      {
        "name": "ddl_question_id",
        "type": "UUID NOT NULL REFERENCES ddl_questions(id)"
      },
      {
        "name": "question_order",
        "type": "INTEGER"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "exam_ddl_summary",
    "file": "infrastructure/supabase/supabase/migrations/20260201190002_ddl_batch_processing.sql",
    "line_start": 95,
    "line_end": 125,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "exam_attempt_id",
        "type": "UUID NOT NULL UNIQUE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES auth.users(id)"
      },
      {
        "name": "batch_job_id",
        "type": "UUID REFERENCES ddl_batch_jobs(id)"
      },
      {
        "name": "total_ddl_questions",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "analyzed_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "le_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lem_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "lie_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "none_count",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_concept_coverage",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_integration_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "avg_anxiety_score",
        "type": "DECIMAL(5,4)"
      },
      {
        "name": "dominant_lacuna_type",
        "type": "lacuna_type"
      },
      {
        "name": "overall_recommendation",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_topics_generated",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 5,
    "line_end": 47,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "TEXT UNIQUE NOT NULL,  -- kebab-case like 'hipertensao-arterial'"
      },
      {
        "name": "version",
        "type": "INTEGER DEFAULT 1"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ('clinica_medica', 'cirurgia', 'pediatria', 'ginecologia_obstetricia', 'saude_coletiva'))"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ('basico', 'intermediario', 'avancado'))"
      },
      {
        "name": "definition",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "epidemiology",
        "type": "TEXT"
      },
      {
        "name": "pathophysiology",
        "type": "TEXT"
      },
      {
        "name": "clinical_presentation",
        "type": "TEXT"
      },
      {
        "name": "diagnosis",
        "type": "TEXT"
      },
      {
        "name": "treatment",
        "type": "TEXT"
      },
      {
        "name": "complications",
        "type": "TEXT"
      },
      {
        "name": "prognosis",
        "type": "TEXT"
      },
      {
        "name": "key_points",
        "type": "TEXT[] NOT NULL DEFAULT '{}'"
      },
      {
        "name": "estimated_read_time",
        "type": "INTEGER"
      },
      {
        "name": "related_disease_ids",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "related_medication_ids",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "source_disease_id",
        "type": "TEXT,  -- Darwin-MFC disease ID if generated from disease"
      },
      {
        "name": "source_type",
        "type": "TEXT CHECK (source_type IN ('darwin-mfc', 'manual', 'hybrid')) DEFAULT 'manual'"
      },
      {
        "name": "generated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "generated_by",
        "type": "TEXT,  -- User ID who initiated generation"
      },
      {
        "name": "validation_score",
        "type": "NUMERIC(3,2) CHECK (validation_score >= 0 AND validation_score <= 1)"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('draft', 'review', 'approved', 'published')) DEFAULT 'draft'"
      },
      {
        "name": "published_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "last_updated",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_citations",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 50,
    "line_end": 68,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "url",
        "type": "TEXT NOT NULL UNIQUE"
      },
      {
        "name": "title",
        "type": "TEXT"
      },
      {
        "name": "source",
        "type": "TEXT,  -- 'Diretriz SBC', 'PubMed', 'UpToDate', 'PubMed', 'Diretriz Brasileira', etc."
      },
      {
        "name": "evidence_level",
        "type": "TEXT CHECK (evidence_level IN ('A', 'B', 'C', 'unknown'))"
      },
      {
        "name": "publication_year",
        "type": "INTEGER"
      },
      {
        "name": "accessed_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "is_accessible",
        "type": "BOOLEAN DEFAULT true"
      },
      {
        "name": "accessibility_checked_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "authors",
        "type": "TEXT"
      },
      {
        "name": "journal",
        "type": "TEXT"
      },
      {
        "name": "doi",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_topic_citations",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 71,
    "line_end": 79,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "section_name",
        "type": "TEXT NOT NULL,  -- Which section uses this citation (definition, epidemiology, etc.)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_research_cache",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 82,
    "line_end": 91,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "search_query",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "results",
        "type": "JSONB NOT NULL,  -- Cached research results"
      },
      {
        "name": "cached_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "expires_at",
        "type": "TIMESTAMPTZ DEFAULT NOW() + INTERVAL '7 days'"
      }
    ]
  },
  {
    "table": "theory_generation_jobs",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 94,
    "line_end": 108,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "batch_name",
        "type": "TEXT"
      },
      {
        "name": "total_topics",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "completed_topics",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "failed_topics",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('pending', 'running', 'completed', 'failed')) DEFAULT 'pending'"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "cost_usd",
        "type": "NUMERIC(10,4) DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "theory_generation_job_topics",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 111,
    "line_end": 121,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "job_id",
        "type": "UUID NOT NULL REFERENCES theory_generation_jobs(id) ON DELETE CASCADE"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "status",
        "type": "TEXT NOT NULL CHECK (status IN ('pending', 'completed', 'failed')) DEFAULT 'pending'"
      },
      {
        "name": "error_message",
        "type": "TEXT"
      },
      {
        "name": "cost_usd",
        "type": "NUMERIC(10,4)"
      },
      {
        "name": "generated_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "theory_validation_results",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 124,
    "line_end": 132,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "validation_stage",
        "type": "TEXT NOT NULL CHECK (validation_stage IN ('structural', 'medical', 'citations', 'readability', 'completeness'))"
      },
      {
        "name": "passed",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "score",
        "type": "NUMERIC(3,2)"
      },
      {
        "name": "issues",
        "type": "TEXT[],  -- Array of issue descriptions"
      }
    ]
  },
  {
    "table": "citation_verification_audit",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 136,
    "line_end": 161,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "is_accessible",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "http_status_code",
        "type": "INTEGER"
      },
      {
        "name": "title_match",
        "type": "BOOLEAN"
      },
      {
        "name": "extracted_title",
        "type": "TEXT"
      },
      {
        "name": "verification_score",
        "type": "NUMERIC(3,2) CHECK (verification_score >= 0 AND verification_score <= 1)"
      },
      {
        "name": "is_authoritative",
        "type": "BOOLEAN"
      },
      {
        "name": "source_type",
        "type": "TEXT CHECK (source_type IN ('brazilian_guideline', 'pubmed', 'uptodate', 'web', 'unknown'))"
      },
      {
        "name": "warnings",
        "type": "TEXT[]"
      },
      {
        "name": "verified_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "verification_method",
        "type": "TEXT CHECK (verification_method IN ('http_check', 'title_extraction', 'ai_review'))"
      },
      {
        "name": "verified_by",
        "type": "TEXT DEFAULT 'ai-system'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "hallucination_audit",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 165,
    "line_end": 192,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "section_name",
        "type": "TEXT NOT NULL CHECK (section_name IN ('definition', 'epidemiology', 'pathophysiology', 'clinicalPresentation', 'diagnosis', 'treatment', 'complications', 'prognosis'))"
      },
      {
        "name": "claim_text",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "claim_hash",
        "type": "TEXT,  -- Hash for deduplication"
      },
      {
        "name": "claim_supported",
        "type": "BOOLEAN NOT NULL"
      },
      {
        "name": "confidence",
        "type": "NUMERIC(3,2) CHECK (confidence >= 0 AND confidence <= 1)"
      },
      {
        "name": "supporting_citations",
        "type": "UUID[],  -- Array of citation IDs that support this claim"
      },
      {
        "name": "is_dangerous_claim",
        "type": "BOOLEAN DEFAULT false,  -- True if claim is about dosages, contraindications, etc."
      },
      {
        "name": "risk_level",
        "type": "TEXT CHECK (risk_level IN ('critical', 'high', 'medium', 'low')) DEFAULT 'low'"
      },
      {
        "name": "reviewed_by",
        "type": "TEXT,  -- Human reviewer if manually verified"
      },
      {
        "name": "reviewed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "review_status",
        "type": "TEXT CHECK (review_status IN ('pending', 'approved', 'disputed', 'rejected'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "citation_provenance_audit",
    "file": "infrastructure/supabase/supabase/migrations/20260203170000_theory_generation_system.sql",
    "line_start": 196,
    "line_end": 210,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "topic_id",
        "type": "UUID NOT NULL REFERENCES theory_topics_generated(id) ON DELETE CASCADE"
      },
      {
        "name": "hallucination_audit_id",
        "type": "UUID NOT NULL REFERENCES hallucination_audit(id) ON DELETE CASCADE"
      },
      {
        "name": "citation_id",
        "type": "UUID NOT NULL REFERENCES theory_citations(id) ON DELETE CASCADE"
      },
      {
        "name": "support_confidence",
        "type": "NUMERIC(3,2) CHECK (support_confidence >= 0 AND support_confidence <= 1)"
      },
      {
        "name": "evidence_strength",
        "type": "TEXT CHECK (evidence_strength IN ('direct', 'indirect', 'speculative'))"
      },
      {
        "name": "justification",
        "type": "TEXT"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "fcr_cases",
    "file": "infrastructure/supabase/supabase/migrations/20260208120000_fractal_clinical_reasoning.sql",
    "line_start": 18,
    "line_end": 54,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "clinical_presentation_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "dados_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "padrao_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "hipotese_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "conduta_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "correct_dados",
        "type": "TEXT[] NOT NULL,       -- multiple correct findings"
      },
      {
        "name": "correct_padrao",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_hipotese",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_conduta",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "structured_explanation",
        "type": "JSONB"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.25"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,1)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "fcr_attempts",
    "file": "infrastructure/supabase/supabase/migrations/20260208120000_fractal_clinical_reasoning.sql",
    "line_start": 80,
    "line_end": 110,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "case_id",
        "type": "UUID REFERENCES fcr_cases(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "selected_dados",
        "type": "TEXT[]"
      },
      {
        "name": "selected_padrao",
        "type": "TEXT"
      },
      {
        "name": "selected_hipotese",
        "type": "TEXT"
      },
      {
        "name": "selected_conduta",
        "type": "TEXT"
      },
      {
        "name": "confidence_dados",
        "type": "INTEGER"
      },
      {
        "name": "confidence_padrao",
        "type": "INTEGER"
      },
      {
        "name": "confidence_hipotese",
        "type": "INTEGER"
      },
      {
        "name": "confidence_conduta",
        "type": "INTEGER"
      },
      {
        "name": "level_results",
        "type": "JSONB,                -- FCRLevelResult[]"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "calibration_score",
        "type": "NUMERIC(5,1),     -- 0-100"
      },
      {
        "name": "overconfidence_index",
        "type": "NUMERIC(5,3),  -- -1 to +1"
      },
      {
        "name": "detected_lacunas",
        "type": "JSONB,             -- FCRDetectedLacuna[]"
      },
      {
        "name": "step_times",
        "type": "JSONB,                   -- { dados: ms, padrao: ms, ... }"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "fcr_calibration_history",
    "file": "infrastructure/supabase/supabase/migrations/20260208120000_fractal_clinical_reasoning.sql",
    "line_start": 142,
    "line_end": 151,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT gen_random_uuid()"
      },
      {
        "name": "user_id",
        "type": "UUID REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "calibration_score",
        "type": "NUMERIC(5,1)"
      },
      {
        "name": "overconfidence_index",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "illusion_count",
        "type": "INTEGER DEFAULT 0,   -- high conf + wrong count"
      },
      {
        "name": "total_levels",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "recorded_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "scripts/cip-achievements-minimal.sql",
    "line_start": 4,
    "line_end": 21,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "scripts/cip-achievements-minimal.sql",
    "line_start": 23,
    "line_end": 33,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "scripts/cip-achievements-safe.sql",
    "line_start": 23,
    "line_end": 40,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "scripts/cip-achievements-safe.sql",
    "line_start": 42,
    "line_end": 52,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "scripts/cip-achievements-schema.sql",
    "line_start": 16,
    "line_end": 64,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "scripts/cip-achievements-schema.sql",
    "line_start": 75,
    "line_end": 95,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  },
  {
    "table": "cip_image_cases",
    "file": "scripts/cip-image-cases-data.sql",
    "line_start": 9,
    "line_end": 31,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL UNIQUE"
      },
      {
        "name": "clinical_context_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "modality",
        "type": "TEXT NOT NULL CHECK (modality IN ('xray','ct','ekg','ultrasound','mri'))"
      },
      {
        "name": "image_description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "ascii_art",
        "type": "TEXT"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ('clinica_medica','cirurgia','ginecologia_obstetricia','pediatria','saude_coletiva'))"
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ('muito_facil','facil','medio','dificil','muito_dificil'))"
      },
      {
        "name": "correct_findings",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "correct_diagnosis",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_next_step",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "modality_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "findings_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "diagnosis_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "next_step_options",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "explanation_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_image_cases",
    "file": "scripts/cip-interpretacao-schema.sql",
    "line_start": 53,
    "line_end": 115,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "clinical_context_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "clinical_context_en",
        "type": "TEXT"
      },
      {
        "name": "modality",
        "type": "TEXT NOT NULL CHECK (modality IN ('xray', 'ct', 'ekg', 'ultrasound', 'mri'))"
      },
      {
        "name": "image_description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "image_description_en",
        "type": "TEXT"
      },
      {
        "name": "ascii_art",
        "type": "TEXT"
      },
      {
        "name": "image_url",
        "type": "TEXT"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ("
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ("
      },
      {
        "name": "correct_findings",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "correct_diagnosis",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_next_step",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "modality_options",
        "type": "JSONB NOT NULL DEFAULT '[]'::jsonb"
      },
      {
        "name": "findings_options",
        "type": "JSONB NOT NULL DEFAULT '[]'::jsonb"
      },
      {
        "name": "diagnosis_options",
        "type": "JSONB NOT NULL DEFAULT '[]'::jsonb"
      },
      {
        "name": "next_step_options",
        "type": "JSONB NOT NULL DEFAULT '[]'::jsonb"
      },
      {
        "name": "explanation_pt",
        "type": "TEXT"
      },
      {
        "name": "explanation_en",
        "type": "TEXT"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.25"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_image_attempts",
    "file": "scripts/cip-interpretacao-schema.sql",
    "line_start": 122,
    "line_end": 163,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "case_id",
        "type": "UUID NOT NULL REFERENCES cip_image_cases(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "selected_modality",
        "type": "TEXT"
      },
      {
        "name": "selected_findings",
        "type": "TEXT[]"
      },
      {
        "name": "selected_diagnosis",
        "type": "TEXT"
      },
      {
        "name": "selected_next_step",
        "type": "TEXT"
      },
      {
        "name": "modality_correct",
        "type": "BOOLEAN"
      },
      {
        "name": "findings_correct_count",
        "type": "INTEGER"
      },
      {
        "name": "findings_total_count",
        "type": "INTEGER"
      },
      {
        "name": "diagnosis_correct",
        "type": "BOOLEAN"
      },
      {
        "name": "next_step_correct",
        "type": "BOOLEAN"
      },
      {
        "name": "total_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "step_times",
        "type": "JSONB DEFAULT '{}'::jsonb"
      },
      {
        "name": "current_step",
        "type": "TEXT DEFAULT 'modality' CHECK (current_step IN ("
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "cip_leaderboard_entries",
    "file": "scripts/cip-leaderboard-schema.sql",
    "line_start": 33,
    "line_end": 46,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "attempt_id",
        "type": "UUID NOT NULL REFERENCES cip_attempts(id) ON DELETE CASCADE"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER NOT NULL DEFAULT 0"
      },
      {
        "name": "percentage_correct",
        "type": "NUMERIC(5,2) NOT NULL DEFAULT 0"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL DEFAULT 'facil'"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL DEFAULT '{}'"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT NOW()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_findings",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 20,
    "line_end": 48,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "text_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "text_en",
        "type": "TEXT"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "icd10_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "atc_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "tags",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnoses",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 60,
    "line_end": 92,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "name_en",
        "type": "TEXT"
      },
      {
        "name": "icd10_code",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "icd10_codes_secondary",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ("
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty_tier",
        "type": "INTEGER DEFAULT 3 CHECK (difficulty_tier >= 1 AND difficulty_tier <= 5)"
      },
      {
        "name": "keywords",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnosis_findings",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 103,
    "line_end": 127,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "diagnosis_id",
        "type": "UUID NOT NULL REFERENCES cip_diagnoses(id) ON DELETE CASCADE"
      },
      {
        "name": "finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id) ON DELETE CASCADE"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "priority",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_primary",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzles",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 138,
    "line_end": 190,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ("
      },
      {
        "name": "settings",
        "type": "JSONB NOT NULL DEFAULT '{"
      },
      {
        "name": "diagnosis_ids",
        "type": "UUID[] NOT NULL"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL"
      },
      {
        "name": "options_per_section",
        "type": "JSONB NOT NULL"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3) DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC(5,3) DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC(5,3) DEFAULT 0.1"
      },
      {
        "name": "time_limit_minutes",
        "type": "INTEGER DEFAULT 30"
      },
      {
        "name": "type",
        "type": "TEXT DEFAULT 'practice' CHECK (type IN ('practice', 'exam', 'custom'))"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id) ON DELETE SET NULL"
      },
      {
        "name": "times_attempted",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "times_completed",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "avg_score",
        "type": "NUMERIC(5,2)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzle_grid",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 202,
    "line_end": 224,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "row_index",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ("
      },
      {
        "name": "correct_finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id)"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC(5,3)"
      }
    ]
  },
  {
    "table": "cip_attempts",
    "file": "scripts/cip-schema-migration.sql",
    "line_start": 233,
    "line_end": 263,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "grid_state",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "time_per_cell",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "theta",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC(5,3)"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN"
      },
      {
        "name": "correct_count",
        "type": "INTEGER"
      },
      {
        "name": "total_cells",
        "type": "INTEGER"
      },
      {
        "name": "section_breakdown",
        "type": "JSONB"
      },
      {
        "name": "diagnosis_breakdown",
        "type": "JSONB"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      }
    ]
  },
  {
    "table": "cip_findings",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 19,
    "line_end": 31,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "text_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "text_en",
        "type": "TEXT"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL CHECK (section IN ('medical_history', 'physical_exam', 'laboratory', 'imaging', 'pathology', 'treatment'))"
      },
      {
        "name": "icd10_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "atc_codes",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "tags",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnoses",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 33,
    "line_end": 45,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "name_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "name_en",
        "type": "TEXT"
      },
      {
        "name": "icd10_code",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "icd10_codes_secondary",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "area",
        "type": "TEXT NOT NULL CHECK (area IN ('clinica_medica', 'cirurgia', 'ginecologia_obstetricia', 'pediatria', 'saude_coletiva'))"
      },
      {
        "name": "subspecialty",
        "type": "TEXT"
      },
      {
        "name": "difficulty_tier",
        "type": "INTEGER DEFAULT 3 CHECK (difficulty_tier >= 1 AND difficulty_tier <= 5)"
      },
      {
        "name": "keywords",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_diagnosis_findings",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 47,
    "line_end": 55,
    "columns": [
      {
        "name": "diagnosis_id",
        "type": "UUID NOT NULL REFERENCES cip_diagnoses(id) ON DELETE CASCADE"
      },
      {
        "name": "finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id) ON DELETE CASCADE"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "is_pathognomonic",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "frequency_percentage",
        "type": "INTEGER CHECK (frequency_percentage >= 0 AND frequency_percentage <= 100)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzles",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 57,
    "line_end": 77,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "title",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description",
        "type": "TEXT"
      },
      {
        "name": "areas",
        "type": "TEXT[] DEFAULT '{}'"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL CHECK (difficulty IN ('muito_facil', 'facil', 'medio', 'dificil', 'muito_dificil'))"
      },
      {
        "name": "settings",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "diagnosis_ids",
        "type": "UUID[] NOT NULL"
      },
      {
        "name": "options_per_section",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "time_limit_minutes",
        "type": "INTEGER DEFAULT 30"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC DEFAULT 0"
      },
      {
        "name": "irt_discrimination",
        "type": "NUMERIC DEFAULT 1.2"
      },
      {
        "name": "irt_guessing",
        "type": "NUMERIC DEFAULT 0.1"
      },
      {
        "name": "type",
        "type": "TEXT DEFAULT 'practice' CHECK (type IN ('practice', 'exam', 'custom'))"
      },
      {
        "name": "is_public",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "is_ai_generated",
        "type": "BOOLEAN DEFAULT FALSE"
      },
      {
        "name": "validated_by",
        "type": "TEXT CHECK (validated_by IN ('community', 'expert', 'both'))"
      },
      {
        "name": "created_by",
        "type": "UUID REFERENCES profiles(id)"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_puzzle_grid",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 79,
    "line_end": 87,
    "columns": [
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "row_index",
        "type": "INTEGER NOT NULL"
      },
      {
        "name": "section",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "correct_finding_id",
        "type": "UUID NOT NULL REFERENCES cip_findings(id)"
      },
      {
        "name": "irt_difficulty",
        "type": "NUMERIC"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_attempts",
    "file": "scripts/cip-schema-safe.sql",
    "line_start": 89,
    "line_end": 107,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "grid_state",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "started_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ"
      },
      {
        "name": "theta",
        "type": "NUMERIC"
      },
      {
        "name": "standard_error",
        "type": "NUMERIC"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER"
      },
      {
        "name": "passed",
        "type": "BOOLEAN"
      },
      {
        "name": "correct_count",
        "type": "INTEGER"
      },
      {
        "name": "total_cells",
        "type": "INTEGER"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "section_breakdown",
        "type": "JSONB"
      },
      {
        "name": "diagnosis_breakdown",
        "type": "JSONB"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "updated_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_leaderboard_entries",
    "file": "scripts/populate-all.sql",
    "line_start": 3812,
    "line_end": 3825,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "puzzle_id",
        "type": "UUID NOT NULL REFERENCES cip_puzzles(id) ON DELETE CASCADE"
      },
      {
        "name": "attempt_id",
        "type": "UUID NOT NULL REFERENCES cip_attempts(id) ON DELETE CASCADE"
      },
      {
        "name": "scaled_score",
        "type": "INTEGER NOT NULL DEFAULT 0"
      },
      {
        "name": "percentage_correct",
        "type": "NUMERIC(5,2) NOT NULL DEFAULT 0"
      },
      {
        "name": "total_time_seconds",
        "type": "INTEGER"
      },
      {
        "name": "difficulty",
        "type": "TEXT NOT NULL DEFAULT 'facil'"
      },
      {
        "name": "areas",
        "type": "TEXT[] NOT NULL DEFAULT '{}'"
      },
      {
        "name": "completed_at",
        "type": "TIMESTAMPTZ NOT NULL DEFAULT NOW()"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "cip_achievements",
    "file": "scripts/populate-all.sql",
    "line_start": 3984,
    "line_end": 4001,
    "columns": [
      {
        "name": "id",
        "type": "TEXT PRIMARY KEY"
      },
      {
        "name": "title_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "title_en",
        "type": "TEXT"
      },
      {
        "name": "description_pt",
        "type": "TEXT NOT NULL"
      },
      {
        "name": "description_en",
        "type": "TEXT"
      },
      {
        "name": "icon",
        "type": "TEXT NOT NULL DEFAULT '\ud83c\udfc6'"
      },
      {
        "name": "tier",
        "type": "TEXT NOT NULL DEFAULT 'bronze' CHECK (tier IN ('bronze', 'silver', 'gold', 'platinum'))"
      },
      {
        "name": "achievement_type",
        "type": "TEXT NOT NULL CHECK (achievement_type IN ("
      },
      {
        "name": "criteria",
        "type": "JSONB NOT NULL DEFAULT '{}'"
      },
      {
        "name": "xp_reward",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "is_active",
        "type": "BOOLEAN DEFAULT TRUE"
      },
      {
        "name": "sort_order",
        "type": "INTEGER DEFAULT 0"
      },
      {
        "name": "created_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      }
    ]
  },
  {
    "table": "user_cip_achievements",
    "file": "scripts/populate-all.sql",
    "line_start": 4003,
    "line_end": 4013,
    "columns": [
      {
        "name": "id",
        "type": "UUID PRIMARY KEY DEFAULT uuid_generate_v4()"
      },
      {
        "name": "user_id",
        "type": "UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE"
      },
      {
        "name": "achievement_id",
        "type": "TEXT NOT NULL REFERENCES cip_achievements(id) ON DELETE CASCADE"
      },
      {
        "name": "unlocked_at",
        "type": "TIMESTAMPTZ DEFAULT NOW()"
      },
      {
        "name": "related_puzzle_id",
        "type": "UUID REFERENCES cip_puzzles(id)"
      },
      {
        "name": "related_attempt_id",
        "type": "UUID REFERENCES cip_attempts(id)"
      },
      {
        "name": "metadata",
        "type": "JSONB DEFAULT '{}'"
      },
      {
        "name": "notified",
        "type": "BOOLEAN DEFAULT FALSE"
      }
    ]
  }
]
